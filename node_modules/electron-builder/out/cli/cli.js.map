{"version":3,"file":"cli.js","sourceRoot":"","sources":["../../src/cli/cli.ts"],"names":[],"mappings":"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","sourcesContent":["#! /usr/bin/env node\n\nimport { exec, log, warn } from \"builder-util\"\nimport { printErrorAndExit } from \"builder-util/out/promise\"\nimport { cyan, dim, green, reset, underline } from \"chalk\"\nimport { parse as parseEnv } from \"dotenv\"\nimport { readFile, readJson } from \"fs-extra-p\"\nimport isCi from \"is-ci\"\nimport * as path from \"path\"\nimport { orNullIfFileNotExist } from \"read-config-file\"\nimport updateNotifier from \"update-notifier\"\nimport yargs from \"yargs\"\nimport { build, configureBuildCommand } from \"../builder\"\nimport { getElectronVersion } from \"../util/electronVersion\"\nimport { getGypEnv } from \"../util/yarn\"\nimport { createSelfSignedCert } from \"./create-self-signed-cert\"\nimport { configureInstallAppDepsCommand, installAppDeps } from \"./install-app-deps\"\nimport { start } from \"./start\"\n\n// tslint:disable:no-unused-expression\nyargs\n  .command([\"build\", \"*\"], \"Build\", configureBuildCommand, wrap(build))\n  .command(\"install-app-deps\", \"Install app deps\", configureInstallAppDepsCommand, wrap(installAppDeps))\n  .command(\"node-gyp-rebuild\", \"Rebuild own native code\", configureInstallAppDepsCommand /* yes, args the same as for install app deps */, wrap(rebuildAppNativeCode))\n  .command(\"create-self-signed-cert\", \"Create self-signed code signing cert for Windows apps\",\n    yargs => yargs\n      .option(\"publisher\", {\n        alias: [\"p\"],\n        type: \"string\",\n        requiresArg: true,\n        description: \"The publisher name\",\n      })\n      .demandOption(\"publisher\"),\n    wrap(argv => createSelfSignedCert(argv.publisher)))\n  .command(\"start\", \"Run application in a development mode using electron-webpack\",\n    yargs => yargs,\n    wrap(argv => start()))\n  .help()\n  .epilog(`See ${underline(\"https://electron.build\")} for more documentation.`)\n  .strict()\n  .argv\n\nfunction wrap(task: (args: any) => Promise<any>) {\n  return (args: any) => {\n    checkIsOutdated()\n    loadEnv(path.join(process.cwd(), \"electron-builder.env\"))\n      .then(() => task(args))\n      .catch(printErrorAndExit)\n  }\n}\n\nfunction checkIsOutdated() {\n  if (isCi || process.env.NO_UPDATE_NOTIFIER != null) {\n    return\n  }\n\n  readJson(path.join(__dirname, \"..\", \"..\", \"package.json\"))\n    .then(it => {\n      if (it.version === \"0.0.0-semantic-release\") {\n        return\n      }\n\n      const notifier = updateNotifier({pkg: it})\n      if (notifier.update != null) {\n        notifier.notify({\n          message: `Update available ${dim(notifier.update.current)}${reset(\" â†’ \")}${green(notifier.update.latest)} \\nRun ${cyan(\"yarn upgrade electron-builder\")} to update`\n        })\n      }\n    })\n    .catch(e => warn(`Cannot check updates: ${e}`))\n}\n\nasync function rebuildAppNativeCode(args: any) {\n  const projectDir = process.cwd()\n  log(`Execute node-gyp rebuild for ${args.platform}:${args.arch}`)\n  // this script must be used only for electron\n  await exec(process.platform === \"win32\" ? \"node-gyp.cmd\" : \"node-gyp\", [\"rebuild\"], {\n    env: getGypEnv({version: await getElectronVersion(projectDir), useCustomDist: true}, args.platform, args.arch, true),\n  })\n}\n\nasync function loadEnv(envFile: string) {\n  const data = await orNullIfFileNotExist(readFile(envFile, \"utf8\"))\n  if (data == null) {\n    return null\n  }\n\n  const parsed = parseEnv(data)\n  for (const key of Object.keys(parsed)) {\n    if (!process.env.hasOwnProperty(key)) {\n      process.env[key] = parsed[key]\n    }\n  }\n  require(\"dotenv-expand\")(parsed)\n  return parsed\n}"]}
