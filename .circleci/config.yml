version: 2
stages:
  build:
    machine:
      image: circleci/classic:201708-01

#    environment:
#      GOPATH: /home/circleci/go
    working_directory: ~/ddev-ui

    steps:
      - checkout

      - run:
          name: VM setup
          command: |
            # instructions from http://ubuntuhandbook.org/index.php/2017/01/install-wine-2-0-ubuntu-16-04-14-04-16-10/
            sudo add-apt-repository ppa:wine/wine-builds && sudo dpkg --add-architecture i386

            # Instructions from https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions
            # the sudo -E bash - here seems to fail with a 130 even though it apparently succeeded.
            curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash - || true
            sudo apt-get -qq install --install-recommends -y build-essential nodejs wine-staging

      - run: make linux

